"use strict";!function(l){l.fn.emozaMetabox=function(){return this.each(function(){var e=l(this),t=e.find(".emoza-metabox-tab"),i=e.find(".emoza-metabox-content"),a=(t.each(function(){var t=l(this);t.on("click",function(e){e.preventDefault();e=i.eq(t.index());t.addClass("active").siblings().removeClass("active"),e.addClass("active").siblings().removeClass("active"),l(document).trigger("emoza-metabox-content-show",e)})}),i.find(".emoza-metabox-field-repeater")),o=(a.length&&a.each(function(){var i=l(this).find("ul");i.sortable({axis:"y",cursor:"move",helper:"original",handle:".emoza-metabox-field-repeater-move"}),a.find(".emoza-metabox-field-repeater-add").on("click",function(e){e.preventDefault();var e=i.find("li").first().clone(!0),t=e.find("input");t.attr("name",t.data("name")),e.removeClass("hidden"),i.append(e)}),a.find(".emoza-metabox-field-repeater-remove").on("click",function(e){e.preventDefault(),l(this).closest("li").remove()})}),i.find(".emoza-metabox-field-uploads")),n=(o.length&&o.each(function(){var i,a,n=l(this).find("ul");n.sortable({axis:"y",cursor:"move",helper:"original",handle:".emoza-metabox-field-uploads-move"}),o.find(".emoza-metabox-field-uploads-add").on("click",function(e){e.preventDefault();var t=n.find("li"),e=t.first().clone(!0);e.find("input").each(function(){l(this).attr("name",l(this).data("name").replace("0",t.length))}),e.removeClass("hidden"),n.append(e)}),o.find(".emoza-metabox-field-uploads-upload").on("click",function(e){e.preventDefault(),a=l(this).closest("li").find(" > input"),i&&i.options.library.type===n.data("library")?i.open():(i=window.wp.media({library:{type:n.data("library")||"image"}}).open()).on("select",function(){var e=i.state().get("selection").first().toJSON();a.val(e.url)})}),o.find(".emoza-metabox-field-uploads-thumbnail-upload").on("click",function(e){e.preventDefault(),a=l(this).parent().find("input"),i&&"image"===i.options.library.type?i.open():(i=window.wp.media({library:{type:"image"}}).open()).on("select",function(){var e=i.state().get("selection").first().toJSON(),t=a.parent();a.val(e.id),t.find("span").hide(),t.find("img").remove(),t.find(".emoza-metabox-field-uploads-thumbnail-remove").show(),t.find(".emoza-metabox-field-uploads-thumbnail-upload").append(l("<img>").attr({src:e.url}))})}),o.find(".emoza-metabox-field-uploads-thumbnail-remove").on("click",function(e){e.preventDefault();e=l(this).parent();e.find("span").show(),e.find("img").remove(),e.find("input").val(""),e.find(".emoza-metabox-field-uploads-thumbnail-remove").hide()}),o.find(".emoza-metabox-field-uploads-remove").on("click",function(e){e.preventDefault(),l(this).closest("li").remove()})}),i.find(".emoza-metabox-field-size-chart")),e=(n.length&&(n.on("multidimensional",function(e,t){(t||n).find("input").each(function(){var e=l(this),t=Math.max(0,e.closest("li").index()-1),i=Math.max(0,e.closest("tr").index()-1),e=Math.max(0,e.closest("td").index());this.name=this.name.replace(/(\[\d+\])\[sizes\](\[\d+\])(\[\d+\])/,"["+t+"][sizes]["+i+"]["+e+"]"),this.name=this.name.replace(/(\[\d+\])\[name\]/,"["+t+"][name]")})}),n.each(function(){var t=l(this).find("ul");n.on("click",".emoza-add",function(e){e.preventDefault();e=t.find("li").first().clone(!0);e.find("input").each(function(){l(this).attr("name",l(this).data("name")),l(this).removeAttr("data-name")}),e.removeClass("hidden"),t.append(e),n.trigger("multidimensional",[e])}),n.on("click",".emoza-add-col",function(e){e.preventDefault();var e=l(this).closest("td"),t=l(this).closest("table");l(this).closest("tbody").find("tr td:nth-child("+(e.index()+1)+")").each(function(){var e=l(this),t=e.clone(!0);t.find("input").val(""),e.after(t)}),n.trigger("multidimensional",[t])}),n.on("click",".emoza-del-col",function(e){e.preventDefault();var e=l(this).closest("td"),t=l(this).closest("table"),i=l(this).closest("tr").find("td").length,e=l(this).closest("tbody").find("tr td:nth-child("+(e.index()+1)+")");2<i?e.remove():e.find("input").val(""),n.trigger("multidimensional",[t])}),n.on("click",".emoza-add-row",function(e){e.preventDefault();var e=l(this).closest("tr"),t=l(this).closest("table"),i=e.clone(!0);i.find("input").val(""),e.after(i),n.trigger("multidimensional",[t])}),n.on("click",".emoza-del-row",function(e){e.preventDefault();var e=l(this).closest("tr"),t=l(this).closest("table");2<l(this).closest("tbody").find("tr").length?e.remove():e.find("input").val(""),n.trigger("multidimensional",[t])}),n.on("click",".emoza-remove",function(e){e.preventDefault(),l(this).closest("li").remove(),n.trigger("multidimensional")}),n.on("click",".emoza-duplicate",function(e){e.preventDefault();var e=l(this).closest("li"),t=e.clone(!0);e.after(t),n.trigger("multidimensional")})})),l(".emoza-metabox-field-media")),d=(e.length&&e.each(function(){var i,e=l(this),a=e.find(".emoza-metabox-field-media-input"),n=e.find(".emoza-metabox-field-media-preview img"),t=e.find(".emoza-metabox-field-media-upload"),o=e.find(".emoza-metabox-field-media-remove"),d=n.data("placeholder");t.on("click",function(e){e.preventDefault(),i||(i=window.wp.media({library:{type:"image"}})).on("select",function(){var e=i.state().get("selection").first().toJSON(),t=(e&&e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail:e).url;a.val(e.id),n.attr("src",t),o.removeClass("hidden")}),i.open()}),o.on("click",function(e){e.preventDefault(),a.val(""),n.attr("src",d),o.addClass("hidden")})}),l(".emoza-metabox-field-select-ajax")),t=(d.length&&d.each(function(){var e=l(this).find("select"),t=e.data("source"),i=window.emoza_metabox;e.select2({width:"100%",minimumInputLength:1,ajax:{url:i.ajaxurl,dataType:"json",delay:250,cache:!0,data:function(e){return{action:"emoza_select_ajax",nonce:i.ajaxnonce,term:e.term,source:t}},processResults:function(e,t){return e.success?{results:e.data}:{}}}}),d.find(".select2-selection--multiple").append('<span class="emoza-select2-clear"></span>')}),l(".emoza-metabox-field-wc-attributes")),e=(t.length&&t.each(function(){l(this).find("ul").sortable({axis:"y",cursor:"move",helper:"original"})}),l(document).on("emoza-metabox-content-show",function(e,t){var i,t=l(t);t.data("code-editor-initalized")||((i=l(".emoza-metabox-field-code-editor",t)).length&&i.each(function(){var e=l(this).find("textarea"),t=wp.codeEditor.defaultSettings||{};t.codemirror=_.extend({},t.codemirror,{gutters:[]}),wp.codeEditor.initialize(e,t).codemirror.on("keyup",function(e){e.save()})}),t.data("code-editor-initalized",!0))}),i.find("[data-depend-on]"));e.length&&e.each(function(){var t=l(this),e=i.find('[name="'+t.data("depend-on")+'"]');e.data("depend-on")||(e.on("change",function(){var e=i.find('[data-depend-on="'+t.data("depend-on")+'"]');l(this).is(":checked")?e.removeClass("emoza-metabox-field-hidden"):e.addClass("emoza-metabox-field-hidden")}),e.data("depend-on",!0))})})},l(document).ready(function(e){e(".emoza-metabox").emozaMetabox()})}(jQuery);